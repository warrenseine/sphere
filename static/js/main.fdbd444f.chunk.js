(this.webpackJsonpsphere=this.webpackJsonpsphere||[]).push([[0],{49:function(e,t,n){},50:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var r=n(5),c=n.n(r),o=n(39),i=n.n(o),a=(n(48),n(49),n(10)),u=n(8),s=n(27),l=n(62),b=n(58),d=n(59),f=n(60),j=n(63),O=n(61),v=n(13),p=n(24),h=n(36),w=n(37),m=n(0),x=n(33);n(50);function k(e,t){var n=Object(r.useCallback)((function(n){n.code===e&&t()}),[e,t]);Object(r.useEffect)((function(){return window.addEventListener("keypress",n),function(){window.removeEventListener("keypress",n)}}),[n])}var y=n(12),g=["rgb(249, 65, 68)","rgb(243, 114, 44)","rgb(248, 150, 30)","rgb(249, 199, 79)","rgb(144, 190, 109)","rgb(67, 170, 139)","rgb(87, 117, 144)"];function S(e){return g[e%g.length]}var E=Object(x.a)((function(e,t){return{player:{orientation:new m.Quaternion,color:S(Math.floor(Math.random()*g.length))},balls:Object(h.a)(),nextBallId:0,bricks:Object(h.b)(),nextBrickId:0,outlineSelection:Object(h.c)(),actions:{addBall:function(){return e((function(e){var t=function(e,t){var n=new m.Vector3(0,0,3),r=new m.Vector3(0,0,-1);return{ballId:e,position:n.applyQuaternion(t.orientation),velocity:r.applyQuaternion(t.orientation).multiplyScalar(2),color:t.color}}(e.nextBallId,e.player);return{balls:e.balls.push(t).slice(-3),nextBallId:e.nextBallId+1}}))},removeBrick:function(t){return e((function(e){return{bricks:e.bricks.delete(t)}}))},addRandomBrick:function(){(0,t().actions.addBrick)(function(){var e=.2,t=Math.floor(2*Math.PI/(.4+e)),n=Math.floor(Math.random()*t),r=Math.floor(Math.random()*t);return new m.Vector3(n*(.4+e)+.1,r*(.4+e)+.1,1.5)}())},addBrick:function(t){return e((function(e){var n,r={brickId:n=e.nextBrickId,orbitOffset:t,color:S(n)};return{bricks:e.bricks.set(r.brickId,r),nextBrickId:e.nextBrickId+1}}))},addDefaultBricks:function(){var e=t().actions.addBrick;(function(){for(var e=64,t=1.5,n=[],r=2/e,c=Math.PI*(3-Math.sqrt(5)),o=0;o<e;o++){var i=o*r-1+r/2,a=Math.sqrt(1-Math.pow(i,2)),u=(o+1)%e*c,s=Math.cos(u)*a,l=Math.sin(u)*a;n.push(new m.Vector3(s*t,i*t,l*t))}return n})().forEach(e)},updateBrick:function(t,n){return e((function(e){return{bricks:e.bricks.update(t,(function(e){return Object(u.a)(Object(u.a)({},e),n)}))}}))},setPlayer:function(t){return e((function(e){return{player:Object(u.a)(Object(u.a)({},e.player),t)}}))},addOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.add(t)}}))},removeOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.remove(t)}}))},resetGame:function(){var n=t().actions.addDefaultBricks;e((function(e){return{balls:e.balls.clear(),bricks:e.bricks.clear()}})),n()}}}})),M=function(e){return e.actions.addOutlineSelection},B=function(e){return e.actions.removeOutlineSelection},I=function(e){return e.actions.setPlayer},L=function(e){return e.actions.addBall},C=function(e){return e.actions.updateBrick},V=function(e){return e.actions.resetGame};function z(){var e=Object(r.useRef)(null),t=Object(v.f)((function(e){return e.camera})),n=E(I),c=E(L),o=[2,2,.1],i=new m.Vector3(0,0,5),u=Object(s.b)((function(){return{args:o,mass:1,position:i.toArray(),rotation:[Math.PI,0,0],type:"Static",onCollide:j}})),b=Object(a.a)(u,2),d=b[0],f=b[1],j=Object(r.useCallback)((function(e){}),[]);return k(w.c,c),function(e){var t=Object(r.useState)(!1),n=Object(a.a)(t,2),c=n[0],o=n[1],i=Object(r.useState)(),u=Object(a.a)(i,2),s=u[0],l=u[1],b=Object(r.useState)(),d=Object(a.a)(b,2),f=d[0],j=d[1],O=Object(r.useState)(),v=Object(a.a)(O,2),p=v[0],h=v[1],w=Object(r.useCallback)((function(e){h({x:e.clientX,y:e.clientY}),j({x:e.clientX,y:e.clientY}),l({x:e.clientX,y:e.clientY}),o(!0)}),[l,h,j,o]),m=Object(r.useCallback)((function(e){c&&(j(s),l({x:e.clientX,y:e.clientY}))}),[l,j,s,c]),x=Object(r.useCallback)((function(){s&&p&&Math.abs(s.x-p.x)<10&&Math.abs(s.y-p.y)<10&&(null===e||void 0===e?void 0:e.onUp)&&e.onUp(),l(void 0),j(void 0),h(void 0),o(!1)}),[e,s,p,l,j,h,o]);Object(r.useEffect)((function(){return window.addEventListener("pointerdown",w),window.addEventListener("pointermove",m),window.addEventListener("pointerup",x),function(){window.removeEventListener("pointerdown",w),window.removeEventListener("pointermove",m),window.removeEventListener("pointerup",x)}}),[w,m,x]),s&&f&&(s.x,f.x,s.y,f.y)}({onUp:c}),Object(v.d)((function(e,r){var c=t.getWorldQuaternion(new m.Quaternion),o=(new m.Euler).setFromQuaternion(c),i=t.getWorldPosition(new m.Vector3);f.rotation.copy(o),f.position.copy(i),n({orientation:c})})),Object(r.useEffect)((function(){var e=d.current;return e.addEventListener("collide",j),function(){return e.removeEventListener("collide",j)}}),[d,j]),Object(y.jsx)("group",{children:Object(y.jsx)(l.a,{ref:e,minZoom:6,maxZoom:6,enablePan:!1,enableZoom:!1,enableRotate:!0,enableDamping:!0,camera:t})})}function P(e){var t=E((function(e){return e.balls})),n=t.size>0?0:.6,r=t.size>0?.6/t.size:0;return Object(y.jsxs)("group",Object(u.a)(Object(u.a)({},e),{},{children:[Object(y.jsx)("ambientLight",{intensity:n}),t.map((function(e){return Object(y.jsx)(A,{ball:e,lightIntensity:r},e.ballId)}))]}))}function A(e){var t=e.ball,n=e.lightIntensity,c=E(M),o=E(B),i=Object(s.c)((function(){return{args:.2,mass:1,position:t.position.toArray(),velocity:t.velocity.toArray()}})),u=Object(a.a)(i,1)[0];return Object(r.useEffect)((function(){return c(u),function(){return o(u)}}),[u,c,o]),Object(y.jsxs)("mesh",{ref:u,scale:.2,castShadow:!0,children:[Object(y.jsx)("sphereGeometry",{args:[1,16,16]}),Object(y.jsx)("meshToonMaterial",{attach:"material",color:t.color}),Object(y.jsx)("pointLight",{intensity:n,castShadow:!0,"shadow-mapSize-width":256,"shadow-mapSize-height":256})]})}function Q(){var e=E((function(e){return e.bricks}));return Object(y.jsx)("group",{children:e.valueSeq().map((function(e){return Object(y.jsx)(D,{brick:e},e.brickId)}))})}function D(e){var t=e.brick,n=E((function(e){return e.player.color})),c=E(C),o=E(M),i=E(B),u=Object(r.useMemo)((function(){return function(e,t){var n=new m.Vector3(0,1,0),r=(new m.Matrix4).lookAt(e,t,n);return[(new m.Euler).setFromRotationMatrix(r),e]}(t.orbitOffset,new m.Vector3)}),[t]),l=Object(a.a)(u,2),d=l[0],f=l[1],j=[.4,.4,.1],O=Object(s.b)((function(){return{args:j,mass:1,position:f.toArray(),rotation:d.toArray(),type:"Static",onCollide:p}}),void 0,[d,f]),v=Object(a.a)(O,1)[0],p=Object(r.useCallback)((function(e){c(t.brickId,{color:n})}),[c,t,n]);return Object(r.useEffect)((function(){return o(v),function(){return i(v)}}),[v,o,i]),Object(y.jsx)(b.a,{args:j,radius:.05,ref:v,receiveShadow:!0,children:Object(y.jsx)("meshToonMaterial",{attach:"material",color:t.color})})}function R(){var e=E((function(e){return e.outlineSelection})),t=Object(r.useMemo)((function(){return e.toArray().filter((function(e){return void 0!==e.current}))}),[e]),n=function(e){var t=Object(r.useState)(!1),n=Object(a.a)(t,2),c=n[0],o=n[1],i=Object(r.useCallback)((function(t){t.code===e&&o(!0)}),[e]),u=Object(r.useCallback)((function(t){t.code===e&&o(!1)}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",i),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",u)}}),[i,u]),c}(w.a);return Object(y.jsx)(r.Suspense,{fallback:null,children:Object(y.jsxs)(p.a,{multisampling:0,autoClear:!1,children:[n?Object(y.jsx)(p.b,{active:!0,ratio:.85,delay:new m.Vector2(0,0)}):Object(y.jsx)(p.d,{}),Object(y.jsx)(p.c,{selection:t,edgeStrength:10,pulseSpeed:0,visibleEdgeColor:16777215,hiddenEdgeColor:2230538,blur:!1,xRay:!1,width:2048,height:2048}),Object(y.jsx)(d.a,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0}),Object(y.jsx)(p.e,{eskil:!1,offset:.1,darkness:1.1})]})})}function q(){var e=Object(v.f)(),t=e.gl,n=e.viewport,r=new m.Vector2(1920,1920/n.aspect);return Object(v.d)((function(){t.getDrawingBufferSize(new m.Vector2).equals(r)||t.setDrawingBufferSize(r.x,r.y,1)})),null}function X(){var e=E(V);return Object(r.useEffect)(e,[e]),k(w.b,e),Object(y.jsxs)(v.a,{style:{backgroundColor:"#121212"},shadows:!0,children:[Object(y.jsx)(q,{}),Object(y.jsx)(j.a,{showPanel:0,className:"stats"}),Object(y.jsx)(O.a,{pixelated:!0}),Object(y.jsxs)(s.a,{gravity:[0,0,0],defaultContactMaterial:{friction:0,restitution:1.1},children:[Object(y.jsx)(P,{}),Object(y.jsx)(Q,{}),Object(y.jsx)(z,{})]}),Object(y.jsx)(R,{})]})}Object(f.a)({frustum:3.75,size:.005,near:9.5,samples:17,rings:11}),i.a.render(Object(y.jsx)(c.a.StrictMode,{children:Object(y.jsx)(X,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.fdbd444f.chunk.js.map