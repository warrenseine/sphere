(this.webpackJsonpsphere=this.webpackJsonpsphere||[]).push([[0],{54:function(e,t,n){},56:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n.n(r),i=n(45),c=n.n(i),a=(n(53),n(54),n(15)),u=n(10),s=n(9),l=n(46),d=n(30),b=n(62),f=n(66),j=n(67),O=n(63),v=n(64),m=n(68),h=n(65),w=n(16),p=n(31),x=n(41),y=n(25),k=n(0),g=n(40);n(56);function E(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),o=n[0],i=n[1],c=Object(r.useCallback)((function(t){t.keyCode===e&&i(!0)}),[e]),a=Object(r.useCallback)((function(t){t.keyCode===e&&i(!1)}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",c),window.addEventListener("keyup",a),function(){window.removeEventListener("keydown",c),window.removeEventListener("keyup",a)}}),[c,a]),o}var S=n(12),L=["rgb(249, 65, 68)","rgb(243, 114, 44)","rgb(248, 150, 30)","rgb(249, 199, 79)","rgb(144, 190, 109)","rgb(67, 170, 139)","rgb(87, 117, 144)"];function C(e){return L[e%L.length]}var I=function(e,t){var n=new k.Vector3(0,0,3),r=new k.Vector3(0,0,-1);return function(e,t,n){return{ballId:e,position:t,velocity:n,color:C(e)}}(e,n.applyQuaternion(t.orientation),r.applyQuaternion(t.orientation).multiplyScalar(2))},M=function(e){var t=.2,n=Math.floor(2*Math.PI/(.4+t)),r=Math.floor(Math.random()*n),o=Math.floor(Math.random()*n);return function(e,t){return{brickId:e,orbitOffset:t,color:C(e)}}(e,new k.Vector3(r*(.4+t)+.1,o*(.4+t)+.1,1.5))},A=Object(g.a)((function(e,t){return{player:{orientation:new k.Quaternion},balls:Object(x.a)(),nextBallId:0,bricks:Object(x.b)(),nextBrickId:0,outlineSelection:Object(x.c)(),actions:{addBall:function(){return e((function(e){var t=I(e.nextBallId,e.player);return{balls:e.balls.push(t).slice(-3),nextBallId:e.nextBallId+1}}))},removeBrick:function(t){return e((function(e){return{bricks:e.bricks.delete(t)}}))},addRandomBrick:function(){return e((function(e){var t=M(e.nextBrickId);return{bricks:e.bricks.set(t.brickId,t),nextBrickId:e.nextBrickId+1}}))},updateBrick:function(t,n){return e((function(e){return{bricks:e.bricks.update(t,(function(e){return Object(s.a)(Object(s.a)({},e),n)}))}}))},movePlayer:function(t,n,r,o,i,c){return e((function(e){var a=function(e,t,n,r,o){if(o){var i=2*((window.innerHeight-o.y)/window.innerHeight-.5);return[2*(o.x/window.innerWidth-.5),i]}return[e?-1:t?1:0,r?-1:n?1:0]}(n,r,o,i,c),s=Object(u.a)(a,2),l=s[0],d=s[1],b=new k.Vector3(-1,0,0),f=(new k.Quaternion).setFromAxisAngle(b,d*t),j=new k.Vector3(0,1,0),O=(new k.Quaternion).setFromAxisAngle(j,l*t);return{player:{orientation:e.player.orientation.clone().multiply(f).multiply(O)}}}))},addOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.add(t)}}))},removeOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.remove(t)}}))},resetGame:function(){var e=t().actions.addRandomBrick;Object(a.a)(Array(16)).forEach(e)}}}}));function B(){var e=Object(d.c)((function(){return{args:1,mass:1,type:"Static"}})),t=Object(u.a)(e,1)[0];return Object(S.jsxs)("mesh",{position:[0,0,0],ref:t,receiveShadow:!0,children:[Object(S.jsx)("sphereGeometry",{args:[1,32,32]}),Object(S.jsx)("meshToonMaterial",{attach:"material",color:"hotpink"})]})}function Q(){var e=A((function(e){return e.actions.addOutlineSelection})),t=A((function(e){return e.actions.removeOutlineSelection})),n=E(y.c),o=E(y.d),i=E(y.f),c=E(y.a),a=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(),c=Object(u.a)(i,2),a=c[0],s=c[1],l=Object(r.useCallback)((function(e){s({x:e.clientX,y:e.clientY}),o(!0)}),[s,o]),d=Object(r.useCallback)((function(e){n&&s({x:e.clientX,y:e.clientY})}),[s,n]),b=Object(r.useCallback)((function(e){s({x:e.touches[0].clientX,y:e.touches[0].clientY}),o(!0)}),[s,o]),f=Object(r.useCallback)((function(e){n&&s({x:e.touches[0].clientX,y:e.touches[0].clientY})}),[s,n]),j=Object(r.useCallback)((function(){s(void 0),o(!1)}),[s,o]);return Object(r.useEffect)((function(){return window.addEventListener("touchstart",b),window.addEventListener("touchmove",f),window.addEventListener("touchend",j),window.addEventListener("mousedown",l),window.addEventListener("mousemove",d),window.addEventListener("mouseup",j),function(){window.removeEventListener("touchstart",b),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",j),window.removeEventListener("mousedown",l),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",j)}}),[b,f,j,l,d]),a}(),s=Object(r.useRef)(null),O=Object(r.useRef)(null),v=A((function(e){return e.player})),m=A((function(e){return e.actions.movePlayer})),h=A((function(e){return e.actions.addBall})),p=[1,.2,.1],x=new k.Vector3(0,0,4),g=Object(d.b)((function(){return{args:p,mass:1,position:x.toArray(),rotation:[Math.PI,0,0],type:"Static",onCollide:B}})),L=Object(u.a)(g,2),C=L[0],I=L[1],M=Object(l.useSpring)({to:{distort:0},from:{distort:.4},config:{duration:1500}}).distort,B=Object(r.useCallback)((function(e){return M.reset()}),[M]);return function(e,t){var n=Object(r.useCallback)((function(n){n.keyCode===e&&t()}),[e,t]);Object(r.useEffect)((function(){return window.addEventListener("keypress",n),function(){window.removeEventListener("keypress",n)}}),[n])}(y.e,h),Object(w.d)((function(e,t){m(t,n,o,i,c,a);var r=(new k.Euler).setFromQuaternion(v.orientation),u=x.clone().applyQuaternion(v.orientation);I.rotation.copy(r),I.position.copy(u)})),Object(r.useEffect)((function(){var e=C.current;return e.addEventListener("collide",B),function(){return e.removeEventListener("collide",B)}}),[C,B]),Object(r.useEffect)((function(){return e(C),function(){return t(C)}}),[C,e,t]),Object(S.jsx)("group",{ref:s,position:[0,0,0],children:Object(S.jsxs)(b.a,{args:p,radius:.05,smoothness:8,ref:C,receiveShadow:!0,children:[Object(S.jsx)("meshToonMaterial",{attach:"material",color:"#f3f3f3"}),Object(S.jsx)(f.a,{color:"orange",attach:"material",distort:M.get(),speed:10}),Object(S.jsx)(j.a,{makeDefault:!0,ref:O,position:[0,1,2],rotation:[-Math.PI/16,0,0]})]})})}function V(e){var t=A((function(e){return e.balls}));return Object(S.jsx)("group",Object(s.a)(Object(s.a)({},e),{},{children:t.map((function(e){return Object(S.jsx)(F,{ball:e},e.ballId)}))}))}function F(e){var t=e.ball,n=A((function(e){return e.actions.addOutlineSelection})),o=A((function(e){return e.actions.removeOutlineSelection})),i=Object(d.c)((function(){return{args:.2,mass:1,position:t.position.toArray(),velocity:t.velocity.toArray()}})),c=Object(u.a)(i,1)[0];return Object(r.useEffect)((function(){return n(c),function(){return o(c)}}),[c,n,o]),Object(S.jsxs)("mesh",{ref:c,scale:.2,castShadow:!0,children:[Object(S.jsx)("sphereGeometry",{args:[1,16,16]}),Object(S.jsx)("meshToonMaterial",{attach:"material",color:t.color})]})}function P(){var e=A((function(e){return e.bricks}));return Object(S.jsx)("group",{children:e.valueSeq().map((function(e){return Object(S.jsx)(R,{brick:e},e.brickId)}))})}function R(e){var t=e.brick,n=A((function(e){return e.actions.addOutlineSelection})),o=A((function(e){return e.actions.removeOutlineSelection})),i=Object(r.useMemo)((function(){return function(e){var t=new k.Quaternion;t.setFromAxisAngle(new k.Vector3(1,0,0),e.x);var n=new k.Quaternion;n.setFromAxisAngle(new k.Vector3(0,1,0),e.y);var r=t.multiply(n),o=new k.Euler;return o.setFromQuaternion(r),[o,new k.Vector3(0,0,e.z).applyQuaternion(r)]}(t.orbitOffset)}),[t]),c=Object(u.a)(i,2),a=c[0],s=c[1],l=[.4,.4,.1],f=Object(d.b)((function(){return{args:l,mass:1,position:s.toArray(),rotation:a.toArray(),type:"Static"}}),void 0,[a,s]),j=Object(u.a)(f,1)[0];return Object(r.useEffect)((function(){return n(j),function(){return o(j)}}),[j,n,o]),Object(S.jsx)(b.a,{args:l,radius:.05,smoothness:8,ref:j,receiveShadow:!0,children:Object(S.jsx)("meshToonMaterial",{attach:"material",color:t.color})})}function z(){var e=A((function(e){return e.outlineSelection})),t=Object(r.useMemo)((function(){return e.toArray().filter((function(e){return void 0!==e.current}))}),[e]),n=E(y.b);return Object(S.jsx)(r.Suspense,{fallback:null,children:Object(S.jsxs)(p.a,{multisampling:0,autoClear:!1,children:[n?Object(S.jsx)(p.b,{active:!0,ratio:.85,delay:new k.Vector2(0,0)}):Object(S.jsx)(p.d,{}),Object(S.jsx)(p.c,{selection:t,edgeStrength:10,pulseSpeed:0,visibleEdgeColor:16777215,hiddenEdgeColor:2230538,blur:!1,xRay:!1,width:2048,height:2048}),Object(S.jsx)(O.a,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0}),Object(S.jsx)(p.e,{eskil:!1,offset:.1,darkness:1.1})]})})}function G(){var e=A((function(e){return e.actions.resetGame}));return Object(r.useEffect)(e,[e]),Object(S.jsxs)(w.a,{style:{backgroundColor:"#121212"},shadows:!0,children:[Object(S.jsx)(m.a,{showPanel:0,className:"stats"}),Object(S.jsx)(h.a,{pixelated:!0}),Object(S.jsxs)(d.a,{gravity:[0,0,0],defaultContactMaterial:{friction:0,restitution:1},children:[Object(S.jsx)("pointLight",{position:[30,10,10],castShadow:!0,"shadow-mapSize-width":256,"shadow-mapSize-height":256}),Object(S.jsx)(B,{}),Object(S.jsx)(V,{}),Object(S.jsx)(P,{}),Object(S.jsx)(Q,{})]}),Object(S.jsx)(z,{})]})}Object(v.a)({frustum:3.75,size:.005,near:9.5,samples:17,rings:11}),c.a.render(Object(S.jsx)(o.a.StrictMode,{children:Object(S.jsx)(G,{})}),document.getElementById("root"))}},[[60,1,2]]]);
//# sourceMappingURL=main.eb04b58b.chunk.js.map