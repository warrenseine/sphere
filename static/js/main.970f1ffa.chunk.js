(this.webpackJsonpsphere=this.webpackJsonpsphere||[]).push([[0],{49:function(e,t,n){},50:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var r=n(5),o=n.n(r),c=n(39),i=n.n(c),a=(n(48),n(49),n(9)),u=n(8),s=n(27),l=n(57),d=n(61),f=n(58),b=n(59),j=n(62),O=n(60),v=n(13),w=n(25),h=n(37),m=n(20),p=n(0),k=n(34);n(50);function x(e){var t=Object(r.useState)(!1),n=Object(a.a)(t,2),o=n[0],c=n[1],i=Object(r.useCallback)((function(t){t.keyCode===e&&c(!0)}),[e]),u=Object(r.useCallback)((function(t){t.keyCode===e&&c(!1)}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",i),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",u)}}),[i,u]),o}var y=n(11),g=["rgb(249, 65, 68)","rgb(243, 114, 44)","rgb(248, 150, 30)","rgb(249, 199, 79)","rgb(144, 190, 109)","rgb(67, 170, 139)","rgb(87, 117, 144)"];function E(e){return g[e%g.length]}var S=Object(k.a)((function(e,t){return{player:{orientation:new p.Quaternion,color:E(Math.floor(Math.random()*g.length))},balls:Object(h.a)(),nextBallId:0,bricks:Object(h.b)(),nextBrickId:0,outlineSelection:Object(h.c)(),actions:{addBall:function(){return e((function(e){var t=function(e,t){var n=new p.Vector3(0,0,3),r=new p.Vector3(0,0,-1);return{ballId:e,position:n.applyQuaternion(t.orientation),velocity:r.applyQuaternion(t.orientation).multiplyScalar(2),color:t.color}}(e.nextBallId,e.player);return{balls:e.balls.push(t).slice(-3),nextBallId:e.nextBallId+1}}))},removeBrick:function(t){return e((function(e){return{bricks:e.bricks.delete(t)}}))},addRandomBrick:function(){(0,t().actions.addBrick)(function(){var e=.2,t=Math.floor(2*Math.PI/(.4+e)),n=Math.floor(Math.random()*t),r=Math.floor(Math.random()*t);return new p.Vector3(n*(.4+e)+.1,r*(.4+e)+.1,1.5)}())},addBrick:function(t){return e((function(e){var n,r={brickId:n=e.nextBrickId,orbitOffset:t,color:E(n)};return{bricks:e.bricks.set(r.brickId,r),nextBrickId:e.nextBrickId+1}}))},addDefaultBricks:function(){var n=t().actions.addBrick;e((function(e){(function(){for(var e=64,t=1.5,n=[],r=2/e,o=Math.PI*(3-Math.sqrt(5)),c=0;c<e;c++){var i=c*r-1+r/2,a=Math.sqrt(1-Math.pow(i,2)),u=(c+1)%e*o,s=Math.cos(u)*a,l=Math.sin(u)*a;n.push(new p.Vector3(s*t,i*t,l*t))}return n})().forEach(n)}))},updateBrick:function(t,n){return e((function(e){return{bricks:e.bricks.update(t,(function(e){return Object(u.a)(Object(u.a)({},e),n)}))}}))},movePlayer:function(t,n,r,o,c,i){return e((function(e){var s=function(e,t,n,r,o){if(o){var c=2*((window.innerHeight-o.y)/window.innerHeight-.5);return[2*(o.x/window.innerWidth-.5),c]}return[e?-1:t?1:0,r?-1:n?1:0]}(n,r,o,c,i),l=Object(a.a)(s,2),d=l[0],f=l[1],b=new p.Vector3(-1,0,0),j=(new p.Quaternion).setFromAxisAngle(b,f*t),O=new p.Vector3(0,1,0),v=(new p.Quaternion).setFromAxisAngle(O,d*t),w=e.player.orientation.clone().multiply(j).multiply(v);return{player:Object(u.a)(Object(u.a)({},e.player),{},{orientation:w})}}))},addOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.add(t)}}))},removeOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.remove(t)}}))},resetGame:function(){(0,t().actions.addDefaultBricks)()}}}}));function M(){var e=S((function(e){return e.actions.addOutlineSelection})),t=S((function(e){return e.actions.removeOutlineSelection})),n=x(m.c),o=x(m.d),c=x(m.f),i=x(m.a),u=function(){var e=Object(r.useState)(!1),t=Object(a.a)(e,2),n=t[0],o=t[1],c=Object(r.useState)(),i=Object(a.a)(c,2),u=i[0],s=i[1],l=Object(r.useCallback)((function(e){s({x:e.clientX,y:e.clientY}),o(!0)}),[s,o]),d=Object(r.useCallback)((function(e){n&&s({x:e.clientX,y:e.clientY})}),[s,n]),f=Object(r.useCallback)((function(e){s({x:e.touches[0].clientX,y:e.touches[0].clientY}),o(!0)}),[s,o]),b=Object(r.useCallback)((function(e){n&&s({x:e.touches[0].clientX,y:e.touches[0].clientY})}),[s,n]),j=Object(r.useCallback)((function(){s(void 0),o(!1)}),[s,o]);return Object(r.useEffect)((function(){return window.addEventListener("touchstart",f),window.addEventListener("touchmove",b),window.addEventListener("touchend",j),window.addEventListener("mousedown",l),window.addEventListener("mousemove",d),window.addEventListener("mouseup",j),function(){window.removeEventListener("touchstart",f),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",j),window.removeEventListener("mousedown",l),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",j)}}),[f,b,j,l,d]),u}(),f=Object(r.useRef)(null),b=Object(r.useRef)(null),j=S((function(e){return e.player})),O=S((function(e){return e.actions.movePlayer})),w=S((function(e){return e.actions.addBall})),h=[1,.2,.1],k=new p.Vector3(0,0,4),g=Object(s.b)((function(){return{args:h,mass:1,position:k.toArray(),rotation:[Math.PI,0,0],type:"Static",onCollide:C}})),E=Object(a.a)(g,2),M=E[0],B=E[1],C=Object(r.useCallback)((function(e){}),[]);return function(e,t){var n=Object(r.useCallback)((function(n){n.keyCode===e&&t()}),[e,t]);Object(r.useEffect)((function(){return window.addEventListener("keypress",n),function(){window.removeEventListener("keypress",n)}}),[n])}(m.e,w),Object(v.d)((function(e,t){O(t,n,o,c,i,u);var r=(new p.Euler).setFromQuaternion(j.orientation),a=k.clone().applyQuaternion(j.orientation);B.rotation.copy(r),B.position.copy(a)})),Object(r.useEffect)((function(){var e=M.current;return e.addEventListener("collide",C),function(){return e.removeEventListener("collide",C)}}),[M,C]),Object(r.useEffect)((function(){return e(M),function(){return t(M)}}),[M,e,t]),Object(y.jsx)("group",{ref:f,position:[0,0,0],children:Object(y.jsxs)(l.a,{args:h,radius:.05,ref:M,onClick:w,receiveShadow:!0,children:[Object(y.jsx)("meshToonMaterial",{attach:"material",color:"#f3f3f3"}),Object(y.jsx)(d.a,{makeDefault:!0,ref:b,position:[0,1,2],rotation:[-Math.PI/16,0,0]})]})})}function B(e){var t=S((function(e){return e.balls}));return Object(y.jsx)("group",Object(u.a)(Object(u.a)({},e),{},{children:t.map((function(e){return Object(y.jsx)(C,{ball:e},e.ballId)}))}))}function C(e){var t=e.ball,n=S((function(e){return e.actions.addOutlineSelection})),o=S((function(e){return e.actions.removeOutlineSelection})),c=Object(s.c)((function(){return{args:.2,mass:1,position:t.position.toArray(),velocity:t.velocity.toArray()}})),i=Object(a.a)(c,1)[0];return Object(r.useEffect)((function(){return n(i),function(){return o(i)}}),[i,n,o]),Object(y.jsxs)("mesh",{ref:i,scale:.2,castShadow:!0,children:[Object(y.jsx)("sphereGeometry",{args:[1,16,16]}),Object(y.jsx)("meshToonMaterial",{attach:"material",color:t.color})]})}function L(){var e=S((function(e){return e.bricks}));return Object(y.jsx)("group",{children:e.valueSeq().map((function(e){return Object(y.jsx)(I,{brick:e},e.brickId)}))})}function I(e){var t=e.brick,n=S((function(e){return e.player.color})),o=S((function(e){return e.actions.updateBrick})),c=S((function(e){return e.actions.addOutlineSelection})),i=S((function(e){return e.actions.removeOutlineSelection})),u=Object(r.useMemo)((function(){return function(e,t){var n=new p.Vector3(0,1,0),r=(new p.Matrix4).lookAt(e,t,n);return[(new p.Euler).setFromRotationMatrix(r),e]}(t.orbitOffset,new p.Vector3)}),[t]),d=Object(a.a)(u,2),f=d[0],b=d[1],j=[.4,.4,.1],O=Object(s.b)((function(){return{args:j,mass:1,position:b.toArray(),rotation:f.toArray(),type:"Static",onCollide:w}}),void 0,[f,b]),v=Object(a.a)(O,1)[0],w=Object(r.useCallback)((function(e){o(t.brickId,{color:n})}),[o,t,n]);return Object(r.useEffect)((function(){return c(v),function(){return i(v)}}),[v,c,i]),Object(y.jsx)(l.a,{args:j,radius:.05,ref:v,receiveShadow:!0,children:Object(y.jsx)("meshToonMaterial",{attach:"material",color:t.color})})}function V(){var e=S((function(e){return e.outlineSelection})),t=Object(r.useMemo)((function(){return e.toArray().filter((function(e){return void 0!==e.current}))}),[e]),n=x(m.b);return Object(y.jsx)(r.Suspense,{fallback:null,children:Object(y.jsxs)(w.a,{multisampling:0,autoClear:!1,children:[n?Object(y.jsx)(w.b,{active:!0,ratio:.85,delay:new p.Vector2(0,0)}):Object(y.jsx)(w.d,{}),Object(y.jsx)(w.c,{selection:t,edgeStrength:10,pulseSpeed:0,visibleEdgeColor:16777215,hiddenEdgeColor:2230538,blur:!1,xRay:!1,width:2048,height:2048}),Object(y.jsx)(f.a,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0}),Object(y.jsx)(w.e,{eskil:!1,offset:.1,darkness:1.1})]})})}function A(){var e=Object(v.f)(),t=e.gl,n=e.viewport,r=new p.Vector2(1024,1024/n.aspect);return Object(v.d)((function(){t.getDrawingBufferSize(new p.Vector2).equals(r)||t.setDrawingBufferSize(r.x,r.y,1)})),null}function P(){var e=S((function(e){return e.actions.resetGame}));return Object(r.useEffect)(e,[e]),Object(y.jsxs)(v.a,{style:{backgroundColor:"#121212"},shadows:!0,children:[Object(y.jsx)(A,{}),Object(y.jsx)(j.a,{showPanel:0,className:"stats"}),Object(y.jsx)(O.a,{pixelated:!0}),Object(y.jsxs)(s.a,{gravity:[0,0,0],defaultContactMaterial:{friction:0,restitution:1.1},children:[Object(y.jsx)("pointLight",{position:[30,10,10],castShadow:!0,"shadow-mapSize-width":256,"shadow-mapSize-height":256}),Object(y.jsx)(B,{}),Object(y.jsx)(L,{}),Object(y.jsx)(M,{})]}),Object(y.jsx)(V,{})]})}Object(b.a)({frustum:3.75,size:.005,near:9.5,samples:17,rings:11}),i.a.render(Object(y.jsx)(o.a.StrictMode,{children:Object(y.jsx)(P,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.970f1ffa.chunk.js.map