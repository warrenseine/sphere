(this.webpackJsonpsphere=this.webpackJsonpsphere||[]).push([[0],{49:function(e,t,n){},50:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var r=n(5),o=n.n(r),i=n(39),c=n.n(i),a=(n(48),n(49),n(15)),u=n(9),s=n(8),l=n(25),d=n(57),b=n(61),f=n(58),j=n(59),O=n(62),v=n(60),m=n(13),w=n(26),h=n(37),p=n(20),x=n(0),y=n(35);n(50);function k(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),o=n[0],i=n[1],c=Object(r.useCallback)((function(t){t.keyCode===e&&i(!0)}),[e]),a=Object(r.useCallback)((function(t){t.keyCode===e&&i(!1)}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",c),window.addEventListener("keyup",a),function(){window.removeEventListener("keydown",c),window.removeEventListener("keyup",a)}}),[c,a]),o}var g=n(11),E=["rgb(249, 65, 68)","rgb(243, 114, 44)","rgb(248, 150, 30)","rgb(249, 199, 79)","rgb(144, 190, 109)","rgb(67, 170, 139)","rgb(87, 117, 144)"];function S(e){return E[e%E.length]}var L=function(e,t){var n=new x.Vector3(0,0,3),r=new x.Vector3(0,0,-1);return function(e,t,n){return{ballId:e,position:t,velocity:n,color:S(e)}}(e,n.applyQuaternion(t.orientation),r.applyQuaternion(t.orientation).multiplyScalar(2))},C=function(e){var t=.2,n=Math.floor(2*Math.PI/(.4+t)),r=Math.floor(Math.random()*n),o=Math.floor(Math.random()*n);return function(e,t){return{brickId:e,orbitOffset:t,color:S(e)}}(e,new x.Vector3(r*(.4+t)+.1,o*(.4+t)+.1,1.5))},I=Object(y.a)((function(e,t){return{player:{orientation:new x.Quaternion},balls:Object(h.a)(),nextBallId:0,bricks:Object(h.b)(),nextBrickId:0,outlineSelection:Object(h.c)(),actions:{addBall:function(){return e((function(e){var t=L(e.nextBallId,e.player);return{balls:e.balls.push(t).slice(-3),nextBallId:e.nextBallId+1}}))},removeBrick:function(t){return e((function(e){return{bricks:e.bricks.delete(t)}}))},addRandomBrick:function(){return e((function(e){var t=C(e.nextBrickId);return{bricks:e.bricks.set(t.brickId,t),nextBrickId:e.nextBrickId+1}}))},updateBrick:function(t,n){return e((function(e){return{bricks:e.bricks.update(t,(function(e){return Object(s.a)(Object(s.a)({},e),n)}))}}))},movePlayer:function(t,n,r,o,i,c){return e((function(e){var a=function(e,t,n,r,o){if(o){var i=2*((window.innerHeight-o.y)/window.innerHeight-.5);return[2*(o.x/window.innerWidth-.5),i]}return[e?-1:t?1:0,r?-1:n?1:0]}(n,r,o,i,c),s=Object(u.a)(a,2),l=s[0],d=s[1],b=new x.Vector3(-1,0,0),f=(new x.Quaternion).setFromAxisAngle(b,d*t),j=new x.Vector3(0,1,0),O=(new x.Quaternion).setFromAxisAngle(j,l*t);return{player:{orientation:e.player.orientation.clone().multiply(f).multiply(O)}}}))},addOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.add(t)}}))},removeOutlineSelection:function(t){return e((function(e){return{outlineSelection:e.outlineSelection.remove(t)}}))},resetGame:function(){var e=t().actions.addRandomBrick;Object(a.a)(Array(16)).forEach(e)}}}}));function M(){var e=Object(l.c)((function(){return{args:1,mass:1,type:"Static"}})),t=Object(u.a)(e,1)[0];return Object(g.jsxs)("mesh",{position:[0,0,0],ref:t,receiveShadow:!0,children:[Object(g.jsx)("sphereGeometry",{args:[1,32,32]}),Object(g.jsx)("meshToonMaterial",{attach:"material",color:"hotpink"})]})}function A(){var e=I((function(e){return e.actions.addOutlineSelection})),t=I((function(e){return e.actions.removeOutlineSelection})),n=k(p.c),o=k(p.d),i=k(p.f),c=k(p.a),a=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(),c=Object(u.a)(i,2),a=c[0],s=c[1],l=Object(r.useCallback)((function(e){s({x:e.clientX,y:e.clientY}),o(!0)}),[s,o]),d=Object(r.useCallback)((function(e){n&&s({x:e.clientX,y:e.clientY})}),[s,n]),b=Object(r.useCallback)((function(e){s({x:e.touches[0].clientX,y:e.touches[0].clientY}),o(!0)}),[s,o]),f=Object(r.useCallback)((function(e){n&&s({x:e.touches[0].clientX,y:e.touches[0].clientY})}),[s,n]),j=Object(r.useCallback)((function(){s(void 0),o(!1)}),[s,o]);return Object(r.useEffect)((function(){return window.addEventListener("touchstart",b),window.addEventListener("touchmove",f),window.addEventListener("touchend",j),window.addEventListener("mousedown",l),window.addEventListener("mousemove",d),window.addEventListener("mouseup",j),function(){window.removeEventListener("touchstart",b),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",j),window.removeEventListener("mousedown",l),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",j)}}),[b,f,j,l,d]),a}(),s=Object(r.useRef)(null),f=Object(r.useRef)(null),j=I((function(e){return e.player})),O=I((function(e){return e.actions.movePlayer})),v=I((function(e){return e.actions.addBall})),w=[1,.2,.1],h=new x.Vector3(0,0,4),y=Object(l.b)((function(){return{args:w,mass:1,position:h.toArray(),rotation:[Math.PI,0,0],type:"Static",onCollide:C}})),E=Object(u.a)(y,2),S=E[0],L=E[1],C=Object(r.useCallback)((function(e){}),[]);return function(e,t){var n=Object(r.useCallback)((function(n){n.keyCode===e&&t()}),[e,t]);Object(r.useEffect)((function(){return window.addEventListener("keypress",n),function(){window.removeEventListener("keypress",n)}}),[n])}(p.e,v),Object(m.d)((function(e,t){O(t,n,o,i,c,a);var r=(new x.Euler).setFromQuaternion(j.orientation),u=h.clone().applyQuaternion(j.orientation);L.rotation.copy(r),L.position.copy(u)})),Object(r.useEffect)((function(){var e=S.current;return e.addEventListener("collide",C),function(){return e.removeEventListener("collide",C)}}),[S,C]),Object(r.useEffect)((function(){return e(S),function(){return t(S)}}),[S,e,t]),Object(g.jsx)("group",{ref:s,position:[0,0,0],children:Object(g.jsxs)(d.a,{args:w,radius:.05,smoothness:8,ref:S,receiveShadow:!0,children:[Object(g.jsx)("meshToonMaterial",{attach:"material",color:"#f3f3f3"}),Object(g.jsx)(b.a,{makeDefault:!0,ref:f,position:[0,1,2],rotation:[-Math.PI/16,0,0]})]})})}function B(e){var t=I((function(e){return e.balls}));return Object(g.jsx)("group",Object(s.a)(Object(s.a)({},e),{},{children:t.map((function(e){return Object(g.jsx)(Q,{ball:e},e.ballId)}))}))}function Q(e){var t=e.ball,n=I((function(e){return e.actions.addOutlineSelection})),o=I((function(e){return e.actions.removeOutlineSelection})),i=Object(l.c)((function(){return{args:.2,mass:1,position:t.position.toArray(),velocity:t.velocity.toArray()}})),c=Object(u.a)(i,1)[0];return Object(r.useEffect)((function(){return n(c),function(){return o(c)}}),[c,n,o]),Object(g.jsxs)("mesh",{ref:c,scale:.2,castShadow:!0,children:[Object(g.jsx)("sphereGeometry",{args:[1,16,16]}),Object(g.jsx)("meshToonMaterial",{attach:"material",color:t.color})]})}function V(){var e=I((function(e){return e.bricks}));return Object(g.jsx)("group",{children:e.valueSeq().map((function(e){return Object(g.jsx)(F,{brick:e},e.brickId)}))})}function F(e){var t=e.brick,n=I((function(e){return e.actions.addOutlineSelection})),o=I((function(e){return e.actions.removeOutlineSelection})),i=Object(r.useMemo)((function(){return function(e){var t=new x.Quaternion;t.setFromAxisAngle(new x.Vector3(1,0,0),e.x);var n=new x.Quaternion;n.setFromAxisAngle(new x.Vector3(0,1,0),e.y);var r=t.multiply(n),o=new x.Euler;return o.setFromQuaternion(r),[o,new x.Vector3(0,0,e.z).applyQuaternion(r)]}(t.orbitOffset)}),[t]),c=Object(u.a)(i,2),a=c[0],s=c[1],b=[.4,.4,.1],f=Object(l.b)((function(){return{args:b,mass:1,position:s.toArray(),rotation:a.toArray(),type:"Static"}}),void 0,[a,s]),j=Object(u.a)(f,1)[0];return Object(r.useEffect)((function(){return n(j),function(){return o(j)}}),[j,n,o]),Object(g.jsx)(d.a,{args:b,radius:.05,smoothness:8,ref:j,receiveShadow:!0,children:Object(g.jsx)("meshToonMaterial",{attach:"material",color:t.color})})}function P(){var e=I((function(e){return e.outlineSelection})),t=Object(r.useMemo)((function(){return e.toArray().filter((function(e){return void 0!==e.current}))}),[e]),n=k(p.b);return Object(g.jsx)(r.Suspense,{fallback:null,children:Object(g.jsxs)(w.a,{multisampling:0,autoClear:!1,children:[n?Object(g.jsx)(w.b,{active:!0,ratio:.85,delay:new x.Vector2(0,0)}):Object(g.jsx)(w.d,{}),Object(g.jsx)(w.c,{selection:t,edgeStrength:10,pulseSpeed:0,visibleEdgeColor:16777215,hiddenEdgeColor:2230538,blur:!1,xRay:!1,width:2048,height:2048}),Object(g.jsx)(f.a,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0}),Object(g.jsx)(w.e,{eskil:!1,offset:.1,darkness:1.1})]})})}function R(){var e=I((function(e){return e.actions.resetGame}));return Object(r.useEffect)(e,[e]),Object(g.jsxs)(m.a,{style:{backgroundColor:"#121212"},shadows:!0,children:[Object(g.jsx)(O.a,{showPanel:0,className:"stats"}),Object(g.jsx)(v.a,{pixelated:!0}),Object(g.jsxs)(l.a,{gravity:[0,0,0],defaultContactMaterial:{friction:0,restitution:1.1},children:[Object(g.jsx)("pointLight",{position:[30,10,10],castShadow:!0,"shadow-mapSize-width":256,"shadow-mapSize-height":256}),Object(g.jsx)(M,{}),Object(g.jsx)(B,{}),Object(g.jsx)(V,{}),Object(g.jsx)(A,{})]}),Object(g.jsx)(P,{})]})}Object(j.a)({frustum:3.75,size:.005,near:9.5,samples:17,rings:11}),c.a.render(Object(g.jsx)(o.a.StrictMode,{children:Object(g.jsx)(R,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.c5f4ae66.chunk.js.map